version: 1

deploy:
  steps:
    setupVariables:
      after:
        - sudo npm install -g aws-cdk
        - npm install
        - pwd
        - ls
        - cdk ls
        - cdk synth
    terraformPlan:
      before: 
        - cdk diff
    terraformApply:
      after:
        - cdk deploy

destroy:
  steps:
    terraformApply:
      after:
        - cdk destroy