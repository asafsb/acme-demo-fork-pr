version: 1

deploy:
  steps:
    setupVariables:
      after:
        - sudo npm install -g aws-cdk
        - npm install
        - cdk ls
        - cdk synth
        - cdk bootstrap aws://244172364962/us-west-2
    terraformPlan:
      before: 
        - cdk diff
    terraformApply:
      after:
        - cdk deploy

destroy:
  steps:
    terraformDestroy:
      after:
        - cdk destroy