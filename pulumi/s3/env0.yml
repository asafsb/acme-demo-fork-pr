version: 1

deploy:
  steps:
    setupVariables:
      after:
        - npm i
    pulumiPreview:
      before:
        - pulumi config set --path aws:assumeRole.roleArn $ENV0_AWS_ROLE_ARN
        - pulumi config set --path aws:assumeRole.externalId $ENV0_AWS_ROLE_EXTERNAL_ID
        - pulumi config set --path aws:assumeRole.durationSeconds 18000
        - echo "Replacing !!!USER!!! with $USER in index.html"
        - sed 's/!!!USER!!!/'"$USER"'/g' index.template.html > index.html